# MyOs

Минимальная 64-битная ОС: мультизагрузочный загрузчик через GRUB, `boot.asm` переводит CPU в long mode, ядро инициализирует VGA-терминал, таблицу IDT, таймер PIT (100 Гц), клавиатуру, простой менеджер памяти и минимальный shell.

Во время работы:
- Shell (`myos>`) читает ввод с клавиатуры, поддерживает команды `help`, `clear`, `uptime`, `mem`, `echo`, `testmem`.
- Встроенная RAM-файловая система (`fs.c`) с текущим каталогом и базовыми операциями.
- PIT считает тики для вывода аптайма.
- Исключения CPU выводят диагностическое сообщение и останавливают систему.
- При наличии подключённого диска RAM-ФС автоматически сохраняется каждые 60 с (`[autosave] ...` в логе).

### Команды shell

| Команда | Назначение |
| --- | --- |
| `help` | список команд |
| `clear` | очистка экрана |
| `uptime` | аптайм в секундах |
| `mem` | статистика кучи |
| `testmem` | проверка аллокатора |
| `history` | список последних команд |
| `echo TEXT` | вывод строки |
| `pwd` | показать текущий каталог |
| `ls [PATH]` | перечислить каталог (`.` по умолчанию) |
| `cd PATH` | перейти в каталог (`/` по умолчанию) |
| `touch PATH` | создать/обнулить файл |
| `cat PATH` | вывести файл на экран |
| `write PATH DATA` | перезаписать файл строкой DATA |
| `append PATH DATA` | дописать строку DATA в конец файла |
| `mkdir PATH` | создать каталог |
| `rm [-r] PATH` | удалить файл или каталог (`-r` рекурсивно) |
| `savefs` | сохранить RAM-ФС на диск |
| `loadfs` | перезагрузить снимок ФС с диска |
| `poweroff` | завершить работу виртуальной машины |
| `reboot` | перезапустить виртуальную машину |
| `savefs` | сохранить RAM-ФС на диск |
| `loadfs` | принудительно перезагрузить ФС с диска |

## Требования

- `x86_64-elf-gcc`, `x86_64-elf-ld`
- `nasm`
- `grub-mkrescue`
- `qemu-system-x86_64`

## Сборка ISO

```bash
make
```

Образ появится в `build/MyOs.iso`.

## Запуск в QEMU

```bash
make run
```

Команда автоматически создаёт/подключает образ диска `build/myos_disk.img` (8 МиБ, ATA/IDE). При запуске MyOs shell показывает текущий каталог в приглашении (`myos ~/docs>`), причём `~` соответствует `/`.

- Изменили файлы → выполните `savefs`, чтобы записать обновлённую ФС.
- Команда `loadfs` перезагружает снимок без перезапуска виртуалки.
- `poweroff`/`reboot` корректно завершают виртуалку (для сохранения данных перед отключением используйте `savefs`).
- `make clean` удаляет и ISO, и диск; сохраните `build/myos_disk.img`, если он вам нужен.

## Очистка

```bash
make clean
```

